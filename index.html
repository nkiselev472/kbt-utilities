<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="KBT Utilities">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>KBT Utilities</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- Уведомления -->
    <div id="notificationContainer"></div>

    <!-- Главный контейнер -->
    <div class="app-container">
        <!-- Шапка -->
        <header class="app-header">
            <div class="header-left">
                <div class="logo">
                    <i class="fas fa-qrcode"></i>
                    <h1>KBT Utilities</h1>
                </div>
                <span class="app-version">v2.2</span>
            </div>
            
            <div class="header-right">
                <div class="stats-badge" id="statsBadge">
                    <i class="fas fa-database"></i>
                    <span id="statsCount">0/0</span>
                </div>
                <button class="icon-btn" id="themeToggle" title="Сменить тему">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="icon-btn" id="menuToggle" title="Меню">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </header>

        <!-- Выпадающее меню -->
        <div class="dropdown-menu" id="dropdownMenu">
            <div class="menu-section">
                <h3>Данные</h3>
                <button class="menu-item" id="exportAllBtn">
                    <i class="fas fa-file-export"></i>
                    <span>Экспорт всех данных</span>
                </button>
                <button class="menu-item" id="downloadLogBtn">
                    <i class="fas fa-bug"></i>
                    <span>Скачать лог</span>
                </button>
            </div>
            <div class="menu-section">
                <h3>Очистка</h3>
                <button class="menu-item danger" id="clearTransfersBtn">
                    <i class="fas fa-trash"></i>
                    <span>Очистить передачи</span>
                </button>
                <button class="menu-item danger" id="clearQRCodesBtn">
                    <i class="fas fa-trash"></i>
                    <span>Очистить ШК</span>
                </button>
            </div>
            <div class="menu-section">
                <h3>О приложении</h3>
                <div class="app-info-menu">
                    <p><i class="fas fa-mobile-alt"></i> Мобильное веб-приложение</p>
                    <p><i class="fas fa-sync-alt"></i> Данные хранятся локально</p>
                    <p><i class="fas fa-camera"></i> Поддержка iOS/Android</p>
                </div>
            </div>
        </div>

        <!-- Переключатель режимов -->
        <div class="mode-selector">
            <button class="mode-tab active" data-mode="transfer">
                <i class="fas fa-truck-loading"></i>
                <span>Сканер передач</span>
            </button>
            <button class="mode-tab" data-mode="generic">
                <i class="fas fa-qrcode"></i>
                <span>Сканер ШК</span>
            </button>
        </div>

        <!-- Основной контент -->
        <main class="main-content">
            <!-- Сканер передач -->
            <section id="transfer-scanner" class="scanner-section active">
                <div class="scanner-container">
                    <div id="transfer-reader" class="scanner-viewport">
                        <div class="scanner-overlay">
                            <div class="scanner-frame"></div>
                            <div class="scanner-guide">
                                <p>Наведите на QR-код передачи</p>
                                <small>Формат: $1:1:XXXXXXXXXX:</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="scanner-controls">
                        <button id="startTransferScan" class="btn-primary">
                            <i class="fas fa-play"></i>
                            <span>Запустить сканер</span>
                        </button>
                        <button id="stopTransferScan" class="btn-secondary" disabled>
                            <i class="fas fa-stop"></i>
                            <span>Остановить</span>
                        </button>
                    </div>
                </div>

                <div class="data-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-history"></i> История передач</h3>
                        <div class="panel-actions">
                            <button id="exportBtn" class="btn-small">
                                <i class="fas fa-download"></i>
                                Экспорт CSV
                            </button>
                            <button class="btn-small" id="sortByDate">
                                <i class="fas fa-sort-amount-down"></i>
                                Сортировка
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-list-container">
                        <div id="transfer-history" class="data-list">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <p>Нет отсканированных передач</p>
                                <small>Отсканируйте QR-код в формате $1:1:XXXXXXXXXX:</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <span id="transfersCount">Всего: 0</span>
                        <span id="lastScanTime">Последнее: --:--</span>
                    </div>
                </div>
            </section>

            <!-- Сканер ШК -->
            <section id="generic-scanner" class="scanner-section">
                <div class="scanner-container">
                    <div id="generic-reader" class="scanner-viewport">
                        <div class="scanner-overlay">
                            <div class="scanner-frame"></div>
                            <div class="scanner-guide">
                                <p>Наведите на любой QR-код</p>
                                <small>Будет сохранён и сгенерирован QR</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="scanner-controls">
                        <button id="startGenericScan" class="btn-primary">
                            <i class="fas fa-play"></i>
                            <span>Запустить сканер</span>
                        </button>
                        <button id="stopGenericScan" class="btn-secondary" disabled>
                            <i class="fas fa-stop"></i>
                            <span>Остановить</span>
                        </button>
                    </div>
                </div>

                <div class="data-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-qrcode"></i> Сохранённые ШК</h3>
                        <div class="panel-actions">
                            <button class="btn-small" id="filterQR">
                                <i class="fas fa-filter"></i>
                                Фильтр
                            </button>
                        </div>
                    </div>
                    
                    <div class="gallery-controls">
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid">
                                <i class="fas fa-th-large"></i>
                            </button>
                            <button class="view-btn" data-view="list">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        <div class="gallery-stats">
                            <span id="qrCodesCount">0 ШК</span>
                        </div>
                    </div>
                    
                    <div id="qrcode-gallery" class="gallery grid-view">
                        <div class="empty-state">
                            <i class="fas fa-qrcode"></i>
                            <p>Нет сохранённых ШК</p>
                            <small>Отсканируйте QR-коды в режиме сканера</small>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Нижняя панель -->
        <footer class="app-footer">
            <div class="footer-info">
                <p class="connection-status" id="connectionStatus">
                    <i class="fas fa-wifi"></i>
                    <span>Онлайн • Данные сохраняются локально</span>
                </p>
                <p class="storage-info" id="storageInfo">
                    <i class="fas fa-hdd"></i>
                    <span>Память: проверка...</span>
                </p>
            </div>
        </footer>
    </div>

    <!-- Загрузка библиотек -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <!-- Загрузка QRCode через jsDelivr как резервный вариант -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <script src="script.js"></script>
</body>
</html>