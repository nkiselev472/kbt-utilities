<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4f46e5">
    <title>KBT Utilities</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
    <!-- Контейнер приложения -->
    <div class="app-container">
        <!-- Шапка -->
        <header class="app-header">
            <div class="logo-container">
                <i class="fas fa-qrcode logo-icon"></i>
                <h1>KBT Utilities</h1>
                <span class="version">v1.0</span>
            </div>
            <div class="auth-status" id="authStatus">
                <i class="fas fa-circle-notch fa-spin"></i>
                <span>Проверка авторизации...</span>
            </div>
        </header>

        <!-- Основной контент -->
        <main class="main-content">
            <!-- Статус -->
            <div class="status-card" id="statusCard">
                <div class="status-icon">
                    <i class="fas fa-camera"></i>
                </div>
                <div class="status-info">
                    <h3>Готов к сканированию</h3>
                    <p>Наведите камеру на QR-код</p>
                </div>
            </div>

            <!-- Область сканирования -->
            <div class="scanner-container">
                <div class="scanner-frame" id="scannerFrame">
                    <div class="scanner-corner tl"></div>
                    <div class="scanner-corner tr"></div>
                    <div class="scanner-corner bl"></div>
                    <div class="scanner-corner br"></div>
                    <video id="qrVideo" playsinline></video>
                    <canvas id="qrCanvas" class="d-none"></canvas>
                </div>
                <div class="scanner-hint">
                    <i class="fas fa-lightbulb"></i>
                    QR-код должен быть в формате: <code>$1:1:XXXXXXXXXX:YYYYYY</code>
                </div>
            </div>

            <!-- Результаты -->
            <div class="results-card">
                <h3><i class="fas fa-barcode"></i> Результаты сканирования</h3>
                
                <div class="result-row">
                    <label>Исходный код:</label>
                    <div class="result-value" id="rawData">—</div>
                </div>
                
                <div class="result-row">
                    <label>Извлеченный номер:</label>
                    <div class="result-value highlighted" id="extractedNumber">—</div>
                </div>
                
                <div class="result-row">
                    <label>Статус таблицы:</label>
                    <div class="result-value" id="sheetStatus">
                        <i class="fas fa-sync-alt fa-spin"></i> Проверка...
                    </div>
                </div>
            </div>

            <!-- Кнопки управления -->
            <div class="controls">
                <button id="startScanner" class="btn btn-primary">
                    <i class="fas fa-play"></i> Запустить сканер
                </button>
                <button id="stopScanner" class="btn btn-secondary" disabled>
                    <i class="fas fa-stop"></i> Остановить
                </button>
                <button id="sendToSheet" class="btn btn-success" disabled>
                    <i class="fas fa-cloud-upload-alt"></i> Записать в таблицу
                </button>
                <button id="authButton" class="btn btn-google">
                    <i class="fab fa-google"></i> Войти с Google
                </button>
            </div>

            <!-- Журнал -->
            <div class="log-card">
                <div class="log-header">
                    <h3><i class="fas fa-history"></i> Журнал действий</h3>
                    <button id="clearLog" class="btn-icon">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                <div class="log-content" id="logContent">
                    <div class="log-entry">
                        <span class="log-time">14:32:01</span>
                        <span class="log-text">Приложение загружено</span>
                    </div>
                </div>
            </div>

            <!-- Инструкция -->
            <div class="instructions">
                <details>
                    <summary>
                        <i class="fas fa-info-circle"></i> Инструкция по использованию
                    </summary>
                    <ol>
                        <li>Нажмите "Войти с Google" и разрешите доступ к Google Таблицам</li>
                        <li>Нажмите "Запустить сканер" и разрешите доступ к камере</li>
                        <li>Наведите камеру на QR-код с форматом: <code>$1:1:XXXXXXXXXX:YYYYYY</code></li>
                        <li>Программа автоматически извлечет 10-значный номер</li>
                        <li>Нажмите "Записать в таблицу" для сохранения в Google Sheets</li>
                        <li>Данные появятся в столбце A вашей таблицы</li>
                    </ol>
                    <p><strong>Ваша таблица:</strong> 
                    <a href="https://docs.google.com/spreadsheets/d/1jST0QufgFkGuvvQ-iweX21L_LqC0jr4ii7sdHI5wVPU/edit" target="_blank">
                        Открыть таблицу
                    </a></p>
                </details>
            </div>
        </main>

        <!-- Футер -->
        <footer class="app-footer">
            <p>KBT Utilities • Работает на GitHub Pages</p>
            <p class="small">Использует Google Sheets API • Адаптивный дизайн</p>
        </footer>
    </div>

    <!-- Скрипты -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="auth.js"></script>
    <script src="qr-scanner.js"></script>
    <script src="script.js"></script>
</body>
</html>